<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Secure Chat</title>
</head>
<body>
  <h2>ðŸ”¥ Secure Chat App</h2>

  <!-- LOGIN -->
  <div id="loginBox">
    <input type="email" id="email" placeholder="Email"><br><br>
    <input type="password" id="password" placeholder="Password"><br><br>
    <button onclick="signUp()">Sign Up</button>
    <button onclick="login()">Login</button>
  </div>

  <!-- CHAT -->
  <div id="chatBox" style="display:none;">
    <p id="userInfo"></p>

    <div id="messages" style="border:1px solid black;height:250px;overflow:auto;"></div><br>

    <input type="text" id="messageInput" placeholder="Type message">
    <button onclick="sendMessage()">Send</button>
    <button onclick="logout()">Logout</button>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script>
    // ðŸ”¥ REPLACE THIS WITH YOUR FIREBASE CONFIG
    const firebaseConfig = {
      apiKey: "PASTE_YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT_ID.appspot.com",
      messagingSenderId: "PASTE_ID",
      appId: "PASTE_APP_ID"
    };

    firebase.initializeApp(firebaseConfig);

    const auth = firebase.auth();
    const db = firebase.firestore();

    // SIGN UP
    function signUp() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;

      auth.createUserWithEmailAndPassword(email, password)
        .catch(error => alert(error.message));
    }

    // LOGIN
    function login() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;

      auth.signInWithEmailAndPassword(email, password)
        .catch(error => alert(error.message));
    }

    // LOGOUT
    function logout() {
      auth.signOut();
    }

    // AUTH STATE
    auth.onAuthStateChanged(user => {
      if (user) {
        document.getElementById("loginBox").style.display = "none";
        document.getElementById("chatBox").style.display = "block";
        document.getElementById("userInfo").innerText = "Logged in as: " + user.email;
        loadMessages();
      } else {
        document.getElementById("loginBox").style.display = "block";
        document.getElementById("chatBox").style.display = "none";
      }
    });

    // SEND MESSAGE
    function sendMessage() {
      const text = document.getElementById("messageInput").value;

      if (text.trim() === "") return;

      db.collection("messages").add({
        text: text,
        uid: auth.currentUser.uid,
        email: auth.currentUser.email,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });

      document.getElementById("messageInput").value = "";
    }

    // LOAD MESSAGES
    function loadMessages() {
      db.collection("messages")
        .orderBy("createdAt")
        .onSnapshot(snapshot => {
          const messagesDiv = document.getElementById("messages");
          messagesDiv.innerHTML = "";
          snapshot.forEach(doc => {
            const msg = doc.data();
            messagesDiv.innerHTML += `<p><b>${msg.email}:</b> ${msg.text}</p>`;
          });
          messagesDiv.scrollTop = messagesDiv.scrollHeight;
        });
    }
  </script>
</body>
</html>
